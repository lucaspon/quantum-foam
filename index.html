<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>quantum foam</title>

    <script src="https://cdn.jsdelivr.net/npm/p5@1.8.0/lib/p5.js"></script>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inconsolata:wght@300&display=swap"
      rel="stylesheet"
    />
    <link href="/dist/output.css" rel="stylesheet" />

    <script>
      // distribution with skewness function
      function randn_bm(min, max, skew) {
        let u = 0,
          v = 0;
        while (u === 0) u = Math.random(); //Converting [0,1) to (0,1)
        while (v === 0) v = Math.random();
        let num = Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);

        num = num / 10.0 + 0.5; // Translate to 0 -> 1
        if (num > 1 || num < 0)
          num = randn_bm(min, max, skew); // resample between 0 and 1 if out of range
        else {
          num = Math.pow(num, skew); // Skew
          num *= max - min; // Stretch to fill range
          num += min; // offset to min
        }
        return num;
      }

      // Global object to hold variables
      let sketchData;
      let colorIndex = 0;
      let frameCounter = 0;

      let isLooping = true;
      function toggleLoop() {
        if (isLooping) {
          noLoop();
        } else {
          loop();
        }
        isLooping = !isLooping; // Toggle the state
      }

      function setup() {
        const canvasDiv = document.getElementById("canvas");
        const width = canvasDiv.offsetWidth;
        const height = canvasDiv.offsetHeight;

        let canvas = createCanvas(width, height);
        canvas.parent("canvas");

        let bg = color(
          Math.trunc(random(0, 10)),
          Math.trunc(random(0, 10)),
          Math.trunc(random(0, 10))
        );
        background(bg);

        sketchData = {
          width: width,
          height: height,
          palette: [
            color(162, 192, 108), // light green
            color(252, 188, 25), // light yellow
            color(201, 175, 0), // dark yellow
            color(223, 37, 46), // red
            color(248, 147, 29), // light orange
            color(203, 103, 39), // dark orange
            color(255, 255, 255), // white
            color(200, 200, 200), // white
            color(153, 125, 148), // white
            // color(100, 100, 100), // white
            // color(80, 80, 80), // white
          ],
          rmax: 150,
        };

        document.getElementById("toggleLoopButton").addEventListener("click", toggleLoop);
        colorIndex = Math.trunc(random(0, sketchData.palette.length));
      }

      function draw() {
        if (frameCounter > 0 && frameCounter % 30 === 0) {
          // Change color every 90 frames (1.5 second at 60 fps)
          noLoop();
        }
        frameCounter++;

        // noStroke()
        // strokeWeight(2)

        drawSketch(sketchData, sketchData.palette[colorIndex]);
      }

      function drawSketch(data, currentColor) {
        let numrows = Math.trunc(random(25, data.rmax)); // # of rows
        let numcols = numrows + Math.trunc(random(-4, 4)); // # of cols
        let p = [];
        let cl = [];
        let n = 1; // As per original code, n is always 1

        // console.log("rows: " + numrows);
        // console.log("cols: " + numcols);

        // for (let i = 0; i <= n; i++) {
        //     cl[i] = random(data.palette);
        // }

        // define shape position matrix
        for (let col = 0; col <= numcols; col++) {
          p[col] = [];
          for (let row = 0; row <= numrows; row++) {
            p[col][row] = Math.trunc(random(0.3, 1.3)); // chance of a position having a circle
          }
        }

        // draw shapes
        for (let col = 0; col < numcols - 2; col++) {
          for (let row = 0; row < numrows - 2; row++) {
            if (p[col][row] === 1) {
              // define shape color
              let color = currentColor;

              let dist = Math.trunc(random(0, 1.05)); // choose transparency distribution skewness
              let alpha;
              if (dist === 1) {
                alpha = randn_bm(1, 255, 0.4); // closer to 255
              } else {
                alpha = randn_bm(1, 255, 3); // closer to 1
              }
              color.setAlpha(alpha); // choose transparency

              fill(color);
              let x = (data.width / (numcols - 1)) * (col + 1);
              let y = (data.height / (numrows - 1)) * (row + 1);
              let size = (data.width / max(numcols, numrows)) * 0.8;
              circle(x, y, size);
            }
          }
        }
      }
    </script>
  </head>

  <body
    class="min-h-screen min-w-screen md:flex-col bg-black text-slate-400 md:px-12"
    style="font-family: Inconsolata"
  >
    <div class="w-screen h-screen flex flex-col md:flex-row gap-5 p-8 md:p-16 justify-center">
      <div class="w-1/2 my-auto">
        <div class="flex flex-col gap-2">
          <h1 class="text-4xl font-bold text-slate-200">quantum foam</h1>
          <p class="">by lucaspon</p>
        </div>
        <div class="flex flex-col text-left w-fit">
          <span
            id="toggleLoopButton"
            class="font-bold text-sky-500 mt-8 hover:opacity-70 hover:cursor-pointer"
          >
            capture/release
          </span>
        </div>
      </div>
      <div id="canvas" class="h-full w-full"></div>
    </div>
  </body>
</html>
